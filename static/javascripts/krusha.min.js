function updateOffset(){var a=episodes_element.outerHeight()-seasons_element.outerHeight(),b=$(this).scrollTop();0>a?(seasons_element.removeClass("seasons-static"),seasons_element.removeClass("seasons-fixed"),seasons_element.addClass("seasons-relative")):a>b?(seasons_element.addClass("seasons-fixed"),seasons_element.removeClass("seasons-static"),seasons_element.removeClass("seasons-relative")):(seasons_element.addClass("seasons-static"),seasons_element.removeClass("seasons-fixed"),seasons_element.removeClass("seasons-relative"))}!function(){angular.module("growlNotifications.config",[]).value("growlNotifications.config",{debug:!0}),angular.module("growlNotifications.directives",[]),angular.module("growlNotifications.filters",[]),angular.module("growlNotifications.services",[]),angular.module("growlNotifications",["growlNotifications.config","growlNotifications.directives","growlNotifications.filters","growlNotifications.services"])}(),function(){function a(a,c,d){var e={ttl:a.options.ttl||5e3};return{restrict:"AE",scope:!0,controller:b,controllerAs:"$growlNotification",link:function(b,f,g,h){var i=angular.extend({},e,b.$eval(g.growlNotificationOptions));g.ttl&&(i.ttl=b.$eval(g.ttl)),c.move(f,a.element),h.timer=d(function(){c.leave(f)},i.ttl)}}}function b(a,b){this.timer=null,this.remove=function(){b.leave(a),this.timer&&this.timer.cancel&&this.timer.cancel()}}a.$inject=["growlNotifications","$animate","$timeout"],b.$inject=["$element","$animate"],angular.module("growlNotifications.directives").directive("growlNotification",a)}(),function(){function a(a){return{restrict:"AE",link:function(b,c){a.element=c}}}a.$inject=["growlNotifications"],angular.module("growlNotifications.directives").directive("growlNotifications",a)}(),function(){function a(){var a={ttl:5e3};this.setOptions=function(b){return angular.extend(a,b),this},this.ttl=function(b){return angular.isDefined(b)?(a.ttl=b,this):a.ttl},this.$get=function(){function b(){this.options=a,this.element=null}return new b}}angular.module("growlNotifications.services").provider("growlNotifications",a)}(),Array.prototype.find||(Array.prototype.find=function(a){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var b,c=Object(this),d=c.length>>>0,e=arguments[1],f=0;d>f;f++)if(b=c[f],a.call(e,b,f,c))return b;return void 0}),Array.prototype.findIndex||(Array.prototype.findIndex=function(a){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var b,c=Object(this),d=c.length>>>0,e=arguments[1],f=0;d>f;f++)if(b=c[f],a.call(e,b,f,c))return f;return-1});var onloadCallback=function(){grecaptcha.render("recaptcha",{sitekey:"6Lf3Pf8SAAAAADPdiYyjbvd9dHLxY8ZvxJDwKGxY"})},krusha=angular.module("krushaTV",["ngRoute","ngAnimate","ngCookies","ngSanitize","ui.bootstrap","growlNotifications","ngClipboard","cfp.hotkeys"]);krusha.config(["$routeProvider","$httpProvider","$compileProvider","$locationProvider","$tooltipProvider","ngClipProvider","hotkeysProvider",function(a,b,c,d,e,f,g){a.when("/",{templateUrl:"/static/templates/today.html",controller:"todayCtrl"}).when("/search",{templateUrl:"/static/templates/search.html",controller:"searchCtrl"}).when("/show/:id",{templateUrl:"/static/templates/show.html",controller:"showCtrl"}).when("/login",{templateUrl:"/static/templates/login.html",controller:"loginCtrl"}).when("/signup",{templateUrl:"/static/templates/signup.html",controller:"signupCtrl"}).when("/track",{templateUrl:"/static/templates/track.html",controller:"trackCtrl"}).when("/admin/reddit",{templateUrl:"/static/templates/admin/reddit.html",controller:"redditCtrl"}).when("/admin/imdb",{templateUrl:"/static/templates/admin/imdb.html",controller:"imdbCtrl"}).when("/profile",{templateUrl:"/static/templates/profile.html",controller:"profileCtrl"}).when("/unwatched",{templateUrl:"/static/templates/unwatched.html",controller:"unwatchedCtrl"}).when("/watched",{templateUrl:"/static/templates/watched.html",controller:"watchedCtrl"}).when("/calendar",{templateUrl:"/static/templates/calendar.html",controller:"calendarCtrl"}).when("/about",{templateUrl:"/static/templates/about.html"}).otherwise({redirectTo:"/"}),b.interceptors.push("interceptor"),c.debugInfoEnabled(!1),d.html5Mode(!0),e.setTriggers({slideStartEvent:"slideStopEvent"}),f.setPath("/static/javascripts/bower_components/zeroclipboard/dist/ZeroClipboard.swf"),g.cheatSheetHotkey="h"}]),krusha.controller("navCtrl",["$location","hotkeys",function(a,b){b.add({combo:"m",description:"Look at the episodes of today",callback:function(){a.path("/")}}),b.add({combo:"t",description:"Go to your tracked shows",callback:function(){a.path("/track")}}),b.add({combo:"u",description:"Go to your unwatched episodes",callback:function(){a.path("/unwatched")}}),b.add({combo:"w",description:"Go to your watched episodes",callback:function(){a.path("/watched")}}),b.add({combo:"p",description:"Go to profile",callback:function(){a.path("/profile")}}),b.add({combo:"s",description:"Search shows",action:"keyup",callback:function(){var b=$("#navbar_search");b.is(":visible")?b.focus():a.path("/search")}})}]),krusha.controller("parentCtrl",["$scope",function(a){a.title=""}]),krusha.filter("orderByName",["$filter",function(a){var b=/(?:^the )?(.*)/i,c="name",d=function(a){return a[c].match(b)[1]};return function(b,e){return c="undefined"!=typeof e?e:"name",a("orderBy")(b,d)}}]),krusha.filter("formatEpisode",function(){var a=function(a){return a=parseInt(a),10>a?"0"+a.toString():isNaN(a)?"00":a.toString()};return function(b,c){return b=a(b),c=a(c),"S"+c+"E"+b}}),krusha.filter("copyEpisode",["$filter",function(a){return function(b){return b.showname+" "+a("formatEpisode")(b.episode,b.season)}}]),krusha.filter("monthName",function(){var a=["January","February","March","April","May","June","July","August","September","October","November","December"];return function(b){return 1>b||b>12?null:a[b-1]}});var reddit_regex=/^(?:http(?:s)?:\/\/)?(?:www\.)?(?:reddit\.com)?(\/r\/\w+)(?:[.?&/]{1}.*)?$/i,imdb_regex=/^(?:https?:\/\/)?(?:www.)?(?:imdb.com\/title\/)?(tt\d{7})(?:\/.*)?$/i;krusha.directive("subreddit",function(){return{require:"ngModel",link:function(a,b,c,d){d.$validators.subreddit=function(a,b){return d.$isEmpty(a)?!0:reddit_regex.test(b)?!0:!1}}}}),krusha.directive("imdb",function(){return{require:"ngModel",link:function(a,b,c,d){d.$validators.imdb=function(a,b){return d.$isEmpty(a)?!0:imdb_regex.test(b)?!0:!1}}}}),krusha.animation(".fadeSuccess",function(){return{addClass:function(a,b,c){$(a).fadeIn(100,"linear",c)},removeClass:function(a,b,c){$(a).fadeOut(400,"linear",c)}}}),krusha.directive("calendar",["calendarFactory","hotkeys","loggedinFactory",function(a,b,c){var d=new a,e=new c,f=function(a){var c=new Date;a.date_format=e.getDateFormat(),a.$on("loggedin",function(){a.date_format=e.getDateFormat()}),a.active_mode="week",a.year=c.getFullYear(),a.month=c.getMonth()+1,a.allMonth=d.getAllMonth(),a.allYears=d.getAllYears(),a.allWeekdays=null,a.dt=new Date;var f=function(a,b){for(var c in b)if(b.hasOwnProperty(c))for(var d in a)if(a.hasOwnProperty(d)){var e=a[d].date,f=new Date(b[c].airdate);if(e.getFullYear()===f.getFullYear()&&e.getMonth()===f.getMonth()&&e.getDate()===f.getDate()){a[d].shows.push(b[c]);break}}};a.open=function(b){b.preventDefault(),b.stopPropagation(),a.opened=!0},a.changeMonth=function(b,c){if(a.allWeekdays=d.allWeekdays,"undefined"==typeof b||"undefined"==typeof c){var e=new Date;b=e.getFullYear(),c=e.getMonth()+1}var g=d.getDays(b,c);a.getShowsMonth()(b,c).success(function(b){f(g,b.episodes),a.days=g})},a.monthBack=function(){a.month=1===a.month?12:a.month-1,12===a.month&&a.year--,a.changeMonth(a.year,a.month)},a.monthForward=function(){a.month=12===a.month?1:a.month+1,1===a.month&&a.year++,a.changeMonth(a.year,a.month)},a.changeWeek=function(b,c,e){if(a.allWeekdays=d.allWeekdays,"undefined"==typeof b||"undefined"==typeof c||"undefined"==typeof e){var g=new Date;b=g.getFullYear(),c=g.getMonth()+1,e=g.getDate()}a.getShowsWeek()(b,c,e).success(function(b){a.first_day=new Date(b.span.frame.from),a.last_day=new Date(b.span.frame.to);var c=d.getDaysWeek(a.first_day,a.last_day);f(c,b.episodes),a.days=c})},a.changeDayDisplay=function(b,c,e){if("undefined"==typeof b||"undefined"==typeof c||"undefined"==typeof e){var g=new Date;b=g.getFullYear(),c=g.getMonth()+1,e=g.getDate()}var h=new Date(b,c-1,e);a.allWeekdays=[d.getWeekDay(h.getDay())],a.getShowsDay()(b,c,e).success(function(b){a.thisDay=new Date(b.span.date);var c=d.getDaysDay(a.thisDay);f(c,b.episodes),a.days=c})},a.changeToDay=function(b,c,d){a.active_mode="day",g(),a.dt=new Date(b,c-1,d),a.changeDayDisplay(b,c,d)},a.changeDay=function(b){a.dt=new Date(a.dt.setDate(a.dt.getDate()+b)),"week"===a.active_mode?a.changeWeek(a.dt.getFullYear(),a.dt.getMonth()+1,a.dt.getDate()):a.changeDayDisplay(a.dt.getFullYear(),a.dt.getMonth()+1,a.dt.getDate())},a.changeDate=function(b){var c=b.getFullYear(),d=b.getMonth()+1,e=b.getDate();"week"===a.active_mode?a.changeWeek(c,d,e):a.changeDayDisplay(c,d,e)},a.changeMode=function(b){var c=new Date,d=a.active_mode;a.active_mode=b,g(),"month"!==b?("month"===d&&(a.dt="undefined"==typeof a.year||"undefined"==typeof a.month||a.year===c.getFullYear()&&a.month===c.getMonth()+1?c:new Date(a.year,a.month-1,1)),"week"===b?a.changeWeek(a.dt.getFullYear(),a.dt.getMonth()+1,a.dt.getDate()):"day"===b&&a.changeDayDisplay(a.dt.getFullYear(),a.dt.getMonth()+1,a.dt.getDate())):("undefined"==typeof a.dt?(a.year=c.getFullYear(),a.month=c.getMonth()+1):(a.year=a.dt.getFullYear(),a.month=a.dt.getMonth()+1),a.changeMonth(a.year,a.month))};var g=function(){switch(b.del("right"),b.del("left"),a.active_mode){case"month":b.bindTo(a).add({combo:"right",description:"go to next month",callback:function(){a.monthForward()}}).add({combo:"left",description:"go to previous month",callback:function(){a.monthBack()}});break;case"day":b.bindTo(a).add({combo:"right",description:"go to next day",callback:function(){a.changeDay(1)}}).add({combo:"left",description:"go to previous day",callback:function(){a.changeDay(-1)}});break;case"week":b.bindTo(a).add({combo:"right",description:"go to next week",callback:function(){a.changeDay(7)}}).add({combo:"left",description:"go to previous week",callback:function(){a.changeDay(-7)}})}};g(),a.changeWeek(a.dt.getFullYear(),a.dt.getMonth()+1,a.dt.getDate())};return{restrict:"E",link:f,templateUrl:"/static/templates/directives/calendar.html",scope:{getShowsMonth:"&",getShowsWeek:"&",getShowsDay:"&"}}}]),krusha.directive("dates",["$filter","calendarFactory",function(a,b){var c=new b,d=function(b,d,e){if("undefined"!=typeof d){var f=$("<td/>"),g=$("<div/>");g.addClass("date").text(d.date.getDate()).on("click",function(){e()(d.date.getFullYear(),d.date.getMonth()+1,d.date.getDate())}).appendTo(f),$("<span/>").text(c.getWeekDay(d.date.getDay())).appendTo(g);var h=$("<ul/>").addClass("list-unstyled").appendTo(f),i=a("orderByName")(d.shows);i.forEach(function(b){var c=$("<li/>").appendTo(h);$("<a/>").attr("href","/show/"+b.id).text(b.name).appendTo(c),$("<span/>").text(" - "+a("formatEpisode")(b.episode,b.season)).appendTo(c)}),d.active||f.addClass("inactive"),b.append(f)}},e=function(a,b){a.$watch("days",function(){if(b.empty(),"undefined"!=typeof a.days)for(var c=0;c<a.days.length;c+=7){for(var e=$("<tr/>"),f=c;c+7>f;f++)d(e,a.days[f],a.changeToDay);b.append(e)}})};return{restrict:"A",link:e,scope:{days:"=",changeToDay:"&"}}}]),krusha.directive("dailyepisodes",[function(){return{restrict:"E",templateUrl:"/static/templates/directives/dailyepisodes.html",replace:!0}}]),krusha.directive("genreLabels",[function(){var a=function(a,b,c){var d=a.$watch(c.genres,function(b){"undefined"!=typeof b&&(a.genres=b.length>0?b.split(", "):null,d())})};return{restrict:"E",link:a,template:'<span class="label label-default" ng-repeat="genre in ::genres">{{ ::genre }}</span>'}}]),krusha.directive("loadingspinner",["$http",function(a){return{restrict:"E",link:function(b){b.$watch(function(){return a.pendingRequests.length>0},function(a){b.show_spinner=a})},scope:{},template:'<div class="spinner" ng-show="show_spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>'}}]),krusha.directive("loadingcontent",["$http",function(a){return{restrict:"A",link:function(b,c){b.isLoading=function(){return a.pendingRequests.length>0},b.$watch(b.isLoading,function(a){a?c.hide():c.show()})}}}]),krusha.directive("loginButtons",function(){return{restrict:"E",replace:!0,template:'<ul class="login-buttons"><li><a href="/auth/reddit?keep={{ keep_logged_in }}" class="btn btn-default" target="_self"><i class="fa fa-reddit"></i> Reddit</a></li><li><a href="/auth/google?keep={{ keep_logged_in }}" class="btn btn-danger" target="_self"><i class="fa fa-google"></i> Google</a></li><li><a ng-href="/auth/facebook?keep={{ keep_logged_in }}" class="btn btn-primary" target="_self"><i class="fa fa-facebook"></i> Facebook</a></li></ul>'}}),krusha.directive("scrollTo",function(){var a=function(a,b,c){if(""===c.scrollTo)throw"No target defined";b.on("click",function(){$("html,body").animate({scrollTop:$(c.scrollTo).offset().top-70},200)})};return{restrict:"A",scope:{},link:a}});var seasons_element=null,episodes_element=null;krusha.directive("scrollfix",[function(){var a=function(a,b){seasons_element=b.find("#seasons").first(),episodes_element=b.find("#episodes").first();var c=!0,d=setInterval(function(){c=!0},17),e=function(){c===!0&&(c=!1,updateOffset())};$(window).on("scroll",e),b.on("$destroy",function(){$(window).off("scroll",e),clearInterval(d)})};return{restrict:"A",link:a}}]),krusha.directive("slider",["$timeout",function(a){var b=$("body"),c=function(c,d){function e(){q.bind("mousedown touchstart",g)}function f(){m.is(":visible")?(n=m.width(),o=m.offset().left,r=q.width(),p=o+n-r,c.$watch("model",function(b){l&&a(function(){q.trigger("slideStartEvent")});var d=(n-r)/n,e=(b-c.min)/(c.max-c.min)*100*d;q.css("left",e+"%")})):a(f,100)}function g(d){d.preventDefault(),l=!0,a(function(){q.trigger("slideStartEvent")}),q.addClass("active"),"undefined"!=typeof c.onSlideStart&&c.onSlideStart(),b.bind("mouseup touchend",h),b.bind("mousemove",i),b.bind("touchmove",j)}function h(d){d.preventDefault(),l=!1,a(function(){q.trigger("slideStopEvent")}),q.removeClass("active"),b.unbind("mouseup touchend",h),b.unbind("mousemove",i),b.unbind("touchmove",j),"undefined"!=typeof c.onSlideStop&&c.onSlideStop()}function i(a){a.preventDefault(),k(a.pageX)}function j(a){a.preventDefault(),k(a.originalEvent.touches[0].pageX)}function k(a){var b=null;b=o>a?0:a>p?n:a-o,c.$apply(function(){var a=parseInt(c.min)+b/n*(parseInt(c.max)-parseInt(c.min));c.model=a-a%c.step})}var l=!1,m=d.find(".bar"),n=null,o=null,p=null,q=d.find(".handle"),r=null;f(),e(d),"undefined"==typeof c.tooltipPlacement&&(c.tooltipPlacement="top")};return{restrict:"E",link:c,scope:{min:"@",max:"@",step:"@",model:"=ngModel",onSlideStart:"&",onSlideStop:"&",tooltipPlacement:"@"},template:'<div class="bar"><div class="handle" tooltip="{{ model }}" tooltip-placement="{{ ::tooltipPlacement }}" tooltip-trigger="slideStartEvent"></div></div>'}}]),krusha.directive("success",["$timeout","$animate",function(a,b){var c=function(c,d){d.hide();var e=null;c.$watch("successHandler",function(f,g){f!==g&&"not"!==f&&(a.cancel(e),b.addClass(d,"fadeSuccess"),c.success=c.successHandler,c.successHandler="not",e=a(function(){b.removeClass(d,"fadeSuccess")},c.timeout))},!0)};return{restrict:"E",scope:{timeout:"@timeout",successHandler:"=success"},template:"<span ng-class=\"{'text-success fa fa-check': !!success, 'text-danger': !success}\">{{ success === false ? 'Error' : '' }}</span>",link:c}}]),krusha.directive("unwatched",["$timeout","loggedinFactory",function(a,b){var c=new b,d=function(a){"undefined"==typeof a.shows&&(a.shows=[]),"undefined"==typeof a.seasons&&(a.seasons=[]),a.dateFormat=c.getDateFormat(),a.getActiveShow=function(){return a.shows.find(function(a){return!!a.active})},a.scrollShows=function(){$("html,body").animate({scrollTop:$("#shows").offset().top-70},200)},a.getActiveSeason=function(){return a.seasons.find(function(a){return!!a.active})},a.getSeasonsScroll=function(b){a.getSeasons(b),$("html,body").animate({scrollTop:$("#seasons").offset().top-70},200)},a.getEpisodesScroll=function(b,c){a.getEpisodes(b,c),$("html,body").animate({scrollTop:$("#episodes").offset().top-70},200)},a.watched_text=a.watched?"unwatched":"watched",a.watched_text_inv=a.watched?"watched":"unwatched",a.watched_text_cap=a.watched?"Unwatched":"Watched",a.watched_text_cap_short=a.watched?"Unw.":"W."};return{restrict:"E",templateUrl:"/static/templates/directives/unwatched.html",link:d,scope:{shows:"=shows",seasons:"=seasons",episodes:"=episodes",getSeasons:"=getSeasons",getEpisodes:"=getEpisodes",markEpisodeWatched:"=markEpisodeWatched",markSeasonWatched:"=markSeasonWatched",markShowWatched:"=markShowWatched",watched:"=watched"}}}]),krusha.factory("calendarFactory",function(){var a=function(){this.allWeekdays=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]};return a.prototype.lastDayOfMonth=function(a,b){var c=new Date(a,b,0);return c.getDate()},a.prototype.getDays=function(a,b){var c=new Date;("undefined"==typeof a||"undefined"==typeof b)&&(a=c.getFullYear(),b=c.getMonth()+1);var d=this.lastDayOfMonth(a,b),e=new Date(a,b-1,1),f=[];if(1!==e.getDay()){for(var g=0;g>-7;g--){var h=new Date(a,b-1,g);if(f.push({date:h,active:!1,shows:[]}),1===h.getDay())break}f=f.reverse()}for(var i=1;;){var j=new Date(a,b-1,i),k=!0;if(i>d&&(k=!1),f.push({date:j,active:k,shows:[]}),i>=d&&0===j.getDay())break;i++}return f},a.prototype.getDaysWeek=function(a,b){for(var c=[],d=new Date(a);b>=d;d.setDate(d.getDate()+1))c.push({date:new Date(d),active:!0,shows:[]});return c},a.prototype.getDaysDay=function(a){var b=[];return b.push({date:new Date(a),active:!0,shows:[]}),b},a.prototype.getAllMonth=function(){for(var a=[],b=1;12>=b;b++)a.push(b);return a},a.prototype.getAllYears=function(){for(var a=[],b=(new Date).getFullYear()+1,c=b;c>=1950;c--)a.push(c);return a},a.prototype.getWeekDay=function(a){return a-=1,0>a&&(a=6),this.allWeekdays[a]},a}),krusha.factory("interceptor",["$q","loggedinFactory","redirectFactory","notificationsFactory",function(a,b,c,d){var e=new b,f=new c,g=new d,h=null,i=null;return{response:function(a){return a},responseError:function(b){if(401===b.status)e.setStatus(!1),"login"in b.data||f.login();else if(429===b.status){if(null===h||h<Date.parse(b.data.error.nextValidRequestDate)||i+5e3<Date.now()){h=Date.parse(b.data.error.nextValidRequestDate);var c=Math.floor((h-Date.now())/1e3),d=Math.floor(c/60),j=c-60*d,k="You made to many requests. You can make the next request in ";k+=d>0?d+" minutes and ":"",k+=j+" seconds.",i=Date.now(),g.add(k,"danger",5e3,!0)}}else 503===b.status&&g.add(b.data.message,"danger",2e4,!0);return a.reject(b)}}}]),krusha.factory("loggedinFactory",["$rootScope",function(a){var b=!1,c=null,d="yyyy-MM-dd",e=function(){};return e.prototype.getStatus=function(){return b},e.prototype.setStatus=function(c){b=c,a.$broadcast("loggedin")},e.prototype.setUser=function(a){c=a},e.prototype.getUser=function(){return c},e.prototype.getDateFormat=function(){return d},e.prototype.setDateFormat=function(a){d=a?a:"yyyy-MM-dd"},e}]),krusha.factory("notificationsFactory",["$rootScope",function(a){var b=[],c=function(){};return c.prototype.add=function(c,d,e,f,g){"undefined"==typeof f&&(f=!1),"undefined"==typeof g&&(g=!1),b.push({message:c,"class":d,ttl:e,close:f,link:g}),a.$broadcast("notification")},c.prototype.pop=function(){var a=b;return b=[],a},c}]),krusha.factory("redirectFactory",["$location",function(a){var b=null,c=function(){};return c.prototype.login=function(){b=a.path(),a.path("/login")},c.prototype.back=function(){a.path(null!=b&&"/login"!=b?b:"/")},c}]),krusha.service("searchTextFactory",[function(){var a=null,b=function(){};return b.prototype.getText=function(){return a},b.prototype.setText=function(b){a=b},b}]),krusha.factory("apiAuthFactory",["$http",function(a){var b=function(){};return b.prototype.login=function(b,c,d){return"undefined"==typeof d&&(d=!1),a.post("/api/login",{username:b,password:c,keep_logged_in:d})},b.prototype.logout=function(){return a.get("/api/logout")},b.prototype.signup=function(b,c,d){return a.post("/api/signup",{username:b,password:c,captcha:d})},b.prototype.loginStatus=function(){return a.get("/api/status")},b}]),krusha.factory("apiImdbFactory",["$http",function(a){var b=function(){};return b.prototype.submitIMDbId=function(b,c){return a.post("/api/imdb",{imdb_id:b,showid:c})},b.prototype.getSubmittedIMDbIds=function(){return a.get("/api/admin/imdb")},b.prototype.acceptSubmittedIMDbID=function(b){return a.put("/api/admin/imdb/"+b)},b}]),krusha.factory("apiRedditFactory",["$http",function(a){var b=function(){};return b.prototype.subreddit=function(b){return a.get("//www.reddit.com"+b+"/hot.json?limit=5")},b.prototype.reddit5more=function(b,c){return a.get("//www.reddit.com"+b+"/hot.json?limit=5&after="+c)},b.prototype.submitSubreddit=function(b,c){return a.post("/api/subreddit",{subreddit:b,showid:c})},b.prototype.getSubmittedSubreddits=function(){return a.get("/api/admin/subreddit")},b.prototype.acceptSubmittedSubreddit=function(b){return a.put("/api/admin/subreddit/"+b)},b}]),krusha.factory("apiSearchFactory",["$http","$q","loggedinFactory",function(a,b,c){var d=new c,e=function(){};return e.prototype.searchLocal=function(c){var e=!d.getStatus();return c=c.trim(),c.length>=2?a.get("/api/search/"+c,{cache:e}).then(function(a){return a},function(a){return b(function(b,c){return c(a)})}):b(function(a,b){return b({type:"error",code:400,message:"Search query is too short."})})},e.prototype.searchRemote=function(c){return c=c.trim(),c.length>=3?a.get("/api/search/"+c+"/remote",{cache:!0,timeout:12e4}).then(function(a){return a},function(a){return b(function(b,c){return c(a)})}):b(function(a,b){return b({type:"error",code:400,message:"Search query is too short."})})},e}]),krusha.factory("apiSettingsFactory",["$http",function(a){var b=function(){};return b.prototype.setEpisodeOffset=function(b,c){return a.put("/api/profile/settings/episode-offset",{offset:{days:b,hours:c}})},b.prototype.getProfile=function(){return a.get("/api/profile")},b.prototype.setDateFormat=function(b){return a.put("/api/profile/settings/date-format",{date_format:b})},b}]),krusha.factory("apiShowFactory",["$http",function(a){var b=function(){};return b.prototype.addShow=function(b){return a.post("/api/show/",{showid:b},{timeout:12e4})},b.prototype.getShow=function(b){return a.get("/api/show/"+b)},b.prototype.getSeasons=function(b){return a.get("/api/show/"+b+"/season")},b.prototype.getEpisodes=function(b,c){return a.get("/api/show/"+b+"/season/"+c+"/episodes")},b.prototype.getTracked=function(){return a.get("/api/track")},b.prototype.addTracked=function(b){return a.post("/api/track",{showid:b})},b.prototype.deleteTracked=function(b){return a["delete"]("/api/track/"+b)},b.prototype.watchedEpisode=function(b){return a.post("/api/watched/episode",{episodeid:b})},b.prototype.notWatchedEpisode=function(b){return a["delete"]("/api/watched/episode/"+b)},b.prototype.getUnwatched=function(){return a.get("/api/unwatched")},b.prototype.getWatched=function(){return a.get("/api/watched")},b.prototype.markSeasonWatched=function(b,c){return a.post("/api/watched/season",{showid:b,season_nr:c})},b.prototype.markShowWatched=function(b){return a.post("/api/watched/show",{showid:b})},b.prototype.markShowNotWatched=function(b){return a["delete"]("/api/watched/show/"+b)},b.prototype.markSeasonNotWatched=function(b,c){return a["delete"]("/api/watched/season/"+b+"/"+c)},b.prototype.getTodaysEpisodes=function(){return a.get("/api/today")},b.prototype.getomdb=function(b){return a.get("/api/omdb/"+b)},b.prototype.getUnwatchedShows=function(){return a.get("/api/unwatched/shows")},b.prototype.getUnwatchedSeasons=function(b){return a.get("/api/unwatched/shows/"+b+"/seasons")},b.prototype.getUnwatchedEpisodes=function(b,c){return a.get("/api/unwatched/shows/"+b+"/seasons/"+c+"/episodes")},b.prototype.getWatchedShows=function(){return a.get("/api/watched/shows")},b.prototype.getWatchedSeasons=function(b){return a.get("/api/watched/shows/"+b+"/seasons")},b.prototype.getWatchedEpisodes=function(b,c){return a.get("/api/watched/shows/"+b+"/seasons/"+c+"/episodes")},b.prototype.getEpisodesMonth=function(b,c){return a.get("/api/calendar/"+c+"/"+b)},b.prototype.getEpisodesWeek=function(b,c,d){return a.get("/api/calendar/"+d+"/"+c+"/"+b+"/week")},b.prototype.getEpisodesDay=function(b,c,d){return a.get("/api/calendar/"+d+"/"+c+"/"+b)},b}]),krusha.controller("calendarCtrl",["$scope","apiShowFactory",function(a,b){var c=new b;a.$parent.title="Calendar",a.getShowsMonth=function(a,b){return c.getEpisodesMonth(b,a)},a.getShowsWeek=function(a,b,d){return c.getEpisodesWeek(d,b,a)},a.getShowsDay=function(a,b,d){return c.getEpisodesDay(d,b,a)}}]),krusha.controller("loginCtrl",["$scope","$location","apiAuthFactory","notificationsFactory","redirectFactory","loggedinFactory",function(a,b,c,d,e,f){var g=new c,h=new d,i=new e,j=new f;a.$parent.title="Login",a.keep_logged_in=!1,a.alerts=[];var k=function(){g.loginStatus().success(function(){b.path("/")})};a.closeAlert=function(b){a.alerts.splice(b,1)},a.login_full=function(b,c,d){g.login(b,c,d).success(function(a){h.add("Welcome "+a.user+"!","success",5e3),j.setUser(a.user),j.setStatus(!0),j.setDateFormat(a.dateFormat),i.back()}).error(function(b,c){401===c&&a.alerts.push({type:"danger",msg:b.message})})},k()}]),krusha.controller("navLoginCtrl",["$scope","$location","$modal","redirectFactory","apiAuthFactory","loggedinFactory","notificationsFactory",function(a,b,c,d,e,f,g){var h=new d,i=new e,j=new f,k=new g;a.loggedin=!1,a.user={name:null,id:null};var l=function(){i.loginStatus().success(function(a){j.setUser(a.user),j.setDateFormat(a.dateFormat),j.setStatus(!0)}).error(function(a,b){401==b&&j.setStatus(!1)})};a.loginButton=function(){h.login()},a.$on("loggedin",function(){a.loggedin=j.getStatus(),a.user.name=j.getUser()}),a.open=function(){c.open({templateUrl:"static/templates/loginmodal.html",size:"lg",controller:"ModalInstanceCtrl"})},a.logout=function(){i.logout().success(function(){k.add("Logout successful!","warning",5e3),j.setStatus(!1),j.setDateFormat(!1),b.path("/")}).error(function(){k.add("Logout failed!","danger",5e3)})},l()}]),krusha.controller("ModalInstanceCtrl",["$scope","$modalInstance","apiAuthFactory","notificationsFactory","loggedinFactory",function(a,b,c,d,e){var f=new c,g=new e,h=new d;a.alerts=[],a.keep_logged_in=!1,a.cancel=function(){b.dismiss("cancel")},a.login=function(b,c,d){f.login(b,c,d).success(function(b){h.add("Welcome "+b.user+"!","success",5e3),g.setUser(b.user),g.setDateFormat(b.dateFormat),g.setStatus(!0),a.cancel()}).error(function(a,b){401===b&&i(a.message,"danger")})};var i=function(b,c){a.alerts.push({type:c,msg:b})};a.closeAlert=function(b){a.alerts.splice(b,1)}}]),krusha.controller("notificationsCtrl",["$scope","notificationsFactory",function(a,b){var c=new b;a.notifications=[];var d,e=0;a.$on("notification",function(){c.pop().forEach(function(b){d=e++,a.notifications[d]=b})})}]),krusha.controller("profileCtrl",["$scope","$cookieStore","apiSettingsFactory","apiImdbFactory","apiRedditFactory","notificationsFactory","loggedinFactory","hotkeys",function(a,b,c,d,e,f,g,h){var i=new c,j=new d,k=new e,l=new f,m=new g;a.$parent.title="Profile",a.admin=!1,a.setOffsetSuccess={value:"not"},a.changeDateFormatSuccess={value:"not"},a.offsets=[],a.dateFormats={"yyyy-MM-dd":"yyyy-MM-dd (2010-31-12)","dd.MM.yyyy":"dd.MM.yyyy (31.12.2010)","MM/dd/yyyy":"MM/dd/yyyy (12/31/2010)"},a.dateFormat="",a.display={reddit:!0,imdb:!0},"undefined"!=typeof b.get("display")&&(a.display=b.get("display"));var n=["h","m","t","u","w","p","s"],o=new Date;o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0),a.now=o;var p=function(){i.getProfile().success(function(b){a.username=b.user,a.total_shows=b.total_shows,a.total_episodes=b.total_episodes,a.admin=b.admin,a.offset=b.settings.episode_offset,r(a.offset),a.dateFormat=b.settings.date_format}),q()},q=function(){var b=[];for(var c in n)n.hasOwnProperty(c)&&b.push(h.get(n[c]));a.shortcuts=b};a.setOffset=function(b){i.setEpisodeOffset(parseInt(b.days),parseInt(b.hours)).success(function(){a.setOffsetSuccess.value=!0}).error(function(){a.setOffsetSuccess.value=!1})};var r=function(b){if("undefined"!=typeof b){var c=24*b.days+b.hours,d=c%24,e=(c-d)/24;a.days=e,a.hours=d;var f=new Date;f.setHours(0),f.setMinutes(0),f.setSeconds(0),f.setMilliseconds(0),f.setDate(a.now.getDate()+e),f.setHours(a.now.getHours()+d),a.dateDisplayed=f}};a.$watch("offset",r,!0),a.getIMDbIds=function(){j.getSubmittedIMDbIds().success(function(b){a.imdb_ids=b.imdb_ids}).error(function(b,c){404===c&&(a.imdb_ids=null)})},a.acceptIMDbId=function(b){j.acceptSubmittedIMDbID(b).success(function(){a.getIMDbIds()}).error(function(a,b){409===b&&l.add(a.message,"danger",5e3)})},a.getSubreddits=function(){k.getSubmittedSubreddits().success(function(b){a.subreddits=b.subreddits}).error(function(b,c){404===c&&(a.subreddits=null)})},a.acceptSub=function(b){k.acceptSubmittedSubreddit(b).success(function(){a.getSubreddits()})},a.changeDateFormat=function(b){i.setDateFormat(b).success(function(){a.changeDateFormatSuccess.value=!0,m.setDateFormat(b)})},a.changeDisplaySetting=function(a){b.put("display",a)},p()}]),krusha.controller("mainCtrl",["$scope","$rootScope","$location","searchTextFactory",function(a,b,c,d){var e=new d;a.getResults=function(a){e.setText(a),"/search"!==c.path()?c.path("/search"):b.$broadcast("search_input")}}]),krusha.controller("searchCtrl",["$scope","$location","$rootScope","apiSearchFactory","apiShowFactory","searchTextFactory",function(a,b,c,d,e,f){var g=new e,h=new d,i=new f;a.$parent.title="Search Results",a.shows=[],a.shows_remote=[];var j=function(){var b=i.getText();null!==b&&b.length>=2&&(a.shows=[],a.shows_remote=[],h.searchLocal(b).then(function(b){a.shows=b.data.shows},function(){a.shows=[]}),h.searchRemote(b).then(function(b){a.shows_remote=b.data.shows},function(){a.shows_remote=[]}))},k=function(){var b=a.shows;a.shows_remote.forEach(function(a){var c=!1;for(var d in b)if(b.hasOwnProperty(d)&&b[d].showid===a.showid){c=!0;break}c||b.push(a)}),a.result=b};a.$watch("shows",k),a.$watch("shows_remote",k),a.mobileSearch=function(a){i.setText(a),c.$broadcast("search_input")},a.getShow=function(a){"local"===a.location?b.path("/show/"+a.id):g.addShow(a.showid).success(function(a){b.path("/show/"+a.id)})},a.clearSearch=function(){a.mobSearchText="",$("#mobileSearch").focus()},a.$on("search_input",function(){j()}),j()}]),krusha.controller("showCtrl",["$scope","$routeParams","$cookies","$cookieStore","$timeout","apiShowFactory","apiRedditFactory","apiImdbFactory","notificationsFactory","loggedinFactory",function(a,b,c,d,e,f,g,h,i,j){var k=new f,l=new h,m=new g,n=new i,o=new j;a.show={},a.seasons={},a.tracked=null,a.reddit=[],a.showWatched=!0,a.loggedin=o.getStatus(),a.submittedRedditText=!1,a.submittedImdbId=!1,a.dateFormat=o.getDateFormat(),a.$on("loggedin",function(){a.dateFormat=o.getDateFormat()}),a.active_season=1;var p={};a.dateFormat=o.getDateFormat();var q=new Date;q.setDate(q.getDate()-7);var r=new Date;a.display="undefined"!=typeof d.get("display")?d.get("display"):{reddit:!0,imdb:!0},a.$on("loggedin",function(){a.loggedin=o.getStatus(),v(A),a.getEpisodes(A,a.active_season),s()});var s=function(){void 0!==c.showWatched&&a.loggedin===!0&&(a.showWatched="true"===c.showWatched)},t=function(b){k.getomdb(b).success(function(b){a.omdb=b}).error(function(){a.omdb=!1})},u=function(b){m.subreddit(b).success(function(c){p.sub=b,p.after=c.data.after,c.data.children.forEach(function(b){a.reddit.push(b)
})}).error(function(){a.reddit=!1})};a.nextFive=function(){m.reddit5more(p.sub,p.after).success(function(b){p.after=b.data.after,b.data.children.forEach(function(b){a.reddit.push(b)})})};var v=function(b){k.getShow(b).success(function(b){a.show=b,a.$parent.title=a.show.name,a.tracked="tracked"in b?b.tracked:null,b.subreddit&&a.display.reddit&&u(b.subreddit),b.imdbid&&a.display.imdb&&t(b.imdbid)}).error(function(b,c){404===c&&(a.show.name="Show not found")})},w=function(b,c){k.getSeasons(b).success(function(b){a.seasons=b.seasons,"undefined"==typeof c?c=b.season-1:c--,a.seasons[c].active=!0,a.episodes=b.episodes,x()})};a.getEpisodes=function(b,c){a.active_season=c,k.getEpisodes(b,c).success(function(b){a.episodes=b.episodes,a.seasons.find(function(a){return a.active===!0}).active=!1,a.seasons.find(function(a){return a.season===b.season}).active=!0,x(),z()})},a.SaveShowWatched=function(b){c.showWatched=b,a.showWatched=b,y()},a.lessThanAWeek=function(a){var b=new Date(Date.parse(a));return b>=q&&r>=b},a.track=function(b,c){c?k.deleteTracked(b.id).success(function(){a.tracked=!1,n.add("Removed "+b.name+" from tracked shows.","danger",5e3)}):k.addTracked(b.id).success(function(){a.tracked=!0,n.add("Added "+b.name+" to tracked shows.","success",5e3),w(b.id,a.active_season)})},a.watchedEpisode=function(b){var c=a.seasons.find(function(a){return a.active===!0});b.watched?k.notWatchedEpisode(b.id).success(function(){b.watched=!1,c.watched_count--,y()}):k.watchedEpisode(b.id).success(function(){b.watched=!0,c.watched_count++,y()})},a.submitSubreddit=function(b,c){var d=b.match(reddit_regex);m.submitSubreddit(d[1],c).success(function(){a.submittedRedditText=d[1]})},a.submitIMDB=function(b,c){var d=b.match(imdb_regex);l.submitIMDbId(d[1],c).success(function(){a.submittedImdbId=d[1]})};var x=function(){e(updateOffset)};a.unwatchedSeasons=function(){if(a.tracked&&a.showWatched===!1){for(var b in a.seasons)if(a.seasons.hasOwnProperty(b)&&a.seasons[b].episode_count>a.seasons[b].watched_count)return!0;return!1}return!0};var y=function(){if(a.showWatched!==!0){for(var b=!1,c=a.active_season-1;c<a.seasons.length;c++)if(a.seasons.hasOwnProperty(c)&&a.seasons[c].episode_count>a.seasons[c].watched_count){b=c;break}if(!b)for(var d=a.active_season-2;d>=0;d--)if(a.seasons.hasOwnProperty(d)&&a.seasons[d].episode_count>a.seasons[d].watched_count){b=d;break}(b>0||0===b)&&a.getEpisodes(a.show.id,b+1)}},z=function(){$("html,body").animate({scrollTop:$("#episodes").offset().top-70},200)},A=b.id;v(A),w(A),s()}]),krusha.controller("signupCtrl",["$scope","$location","apiAuthFactory","notificationsFactory","loggedinFactory",function(a,b,c,d,e){var f=new c,g=new d,h=new e;a.$parent.title="Sign Up",a.alerts=[];var i=function(){f.loginStatus().success(function(){b.path("/")})};a.closeAlert=function(b){a.alerts.splice(b,1)},a.signup=function(c,d){var e=grecaptcha.getResponse();""===e?a.alerts.push({type:"danger",msg:"You need to complete the captcha."}):f.signup(c,d,e).success(function(a){h.setUser(a.user),h.setStatus(!0),g.add("Welcome "+a.user+"!","success",5e3),b.path("/")}).error(function(b){grecaptcha.reset(),a.alerts.push({type:"danger",msg:b.message})})},i()}]),krusha.controller("todayCtrl",["$scope","$filter","$location","apiShowFactory","loggedinFactory",function(a,b,c,d,e){var f=new d,g=new e;a.$parent.title="New Episodes",a.loggedin=g.getStatus(),a.close_welcome=!1,a.stopClick=function(a){a.stopPropagation()},a.$on("loggedin",function(){h(),a.loggedin=g.getStatus()}),a.close_info=function(){a.close_welcome=!0};var h=function(){f.getTodaysEpisodes().success(function(c){a.todays_episodes=b("filter")(c.episodes,{age:0},!0),a.tomorrows_episodes=b("filter")(c.episodes,{age:-1},!0),a.yesterdays_episodes=b("filter")(c.episodes,{age:1},!0)})};a.changeLocation=function(a){c.path("show/"+a)},h()}]),krusha.controller("trackCtrl",["$scope","apiShowFactory","notificationsFactory",function(a,b,c){var d=new b,e=new c;a.$parent.title="Tracked Shows";var f=function(){d.getTracked().success(function(b){a.shows=b.shows}).error(function(b,c){404===c&&(a.shows=null)})},g=function(a){d.addTracked(a.id).success(function(){f(),e.add("You are now tracking "+a.name+" again.","success",1e4,!0)})};a.doNotTrack=function(b){d.deleteTracked(b.id).success(function(){a.shows.splice(a.shows.indexOf(b),1);var c={link_function:function(){g(b)},text:"Undo"};e.add("Removed "+b.name+" from tracked shows.","danger",1e4,!0,c)})},a.orderByName=function(a){var b=/(?:^the )?(.*)/i;return a.name.match(b)[1]},f()}]),krusha.controller("unwatchedCtrl",["$scope","$filter","apiShowFactory",function(a,b,c){var d=new c;a.$parent.title="Unwatched Episodes",a.watched=!1;var e=function(){d.getUnwatchedShows().success(function(b){a.shows=b.shows,a.shows[0].active=!0,a.seasons=b.seasons,a.seasons[0].active=!0,a.episodes=b.episodes})};a.getUnwatchedSeasons=function(b){d.getUnwatchedSeasons(b).success(function(c){var d=a.shows.find(function(a){return a.id===b});a.shows.forEach(function(a){a.active=!1}),d.active=!0,a.seasons=c.seasons,a.seasons[0].active=!0,a.episodes=c.episodes})},a.getUnwatchedEpisodes=function(b,c){d.getUnwatchedEpisodes(b,c).success(function(b){var d=a.seasons.find(function(a){return a.season===c});a.seasons.forEach(function(a){a.active=!1}),d.active=!0,a.episodes=b.episodes})},a.markEpisodeWatched=function(c){d.watchedEpisode(c.id).success(function(){if(a.episodes.splice(a.episodes.indexOf(c),1),0===a.episodes.length){var d=a.seasons.find(function(a){return!!a.active});a.seasons.splice(a.seasons.indexOf(d),1);var e=a.shows.find(function(a){return!!a.active});a.seasons.length>0?a.getUnwatchedEpisodes(e.id,a.seasons[0].season):(a.shows.splice(a.shows.indexOf(e),1),a.shows.length>0&&a.getUnwatchedSeasons(b("orderByName")(a.shows)[0].id))}})},a.markSeasonWatched=function(){var c=a.seasons.findIndex(function(a){return!!a.active}),e=a.shows.findIndex(function(a){return!!a.active}),f=a.shows[e].id,g=a.seasons[c].season;d.markSeasonWatched(f,g).success(function(){a.seasons.splice(c,1),a.seasons.length>0?a.getUnwatchedEpisodes(f,a.seasons[0].season):(a.shows.splice(e,1),a.shows.length>0&&a.getUnwatchedSeasons(b("orderByName")(a.shows)[0].id))})},a.markShowWatched=function(){var c=a.shows.findIndex(function(a){return!!a.active}),e=a.shows[c].id;d.markShowWatched(e).success(function(){a.shows.splice(c,1),a.shows.length>0&&a.getUnwatchedSeasons(b("orderByName")(a.shows)[0].id)})},e()}]),krusha.controller("watchedCtrl",["$scope","$filter","apiShowFactory",function(a,b,c){var d=new c;a.$parent.title="Watched Episodes",a.watched=!0;var e=function(){d.getWatchedShows().success(function(b){a.shows=b.shows,a.shows[0].active=!0,a.seasons=b.seasons,a.seasons[0].active=!0,a.episodes=b.episodes})};a.getWatchedSeasons=function(b){d.getWatchedSeasons(b).success(function(c){var d=a.shows.find(function(a){return a.id===b});a.shows.forEach(function(a){a.active=!1}),d.active=!0,a.seasons=c.seasons,a.seasons[0].active=!0,a.episodes=c.episodes})},a.getWatchedEpisodes=function(b,c){d.getWatchedEpisodes(b,c).success(function(b){var d=a.seasons.find(function(a){return a.season===c});a.seasons.forEach(function(a){a.active=!1}),d.active=!0,a.episodes=b.episodes})},a.markEpisodeUnwatched=function(c){d.notWatchedEpisode(c.id).success(function(){if(a.episodes.splice(a.episodes.indexOf(c),1),0===a.episodes.length){var d=a.seasons.find(function(a){return!!a.active});a.seasons.splice(a.seasons.indexOf(d),1);var e=a.shows.find(function(a){return!!a.active});a.seasons.length>0?a.getWatchedEpisodes(e.id,a.seasons[0].season):(a.shows.splice(a.shows.indexOf(e),1),a.shows.length>0&&a.getWatchedSeasons(b("orderByName")(a.shows)[0].id))}})},a.markSeasonNotWatched=function(){var c=a.seasons.findIndex(function(a){return!!a.active}),e=a.shows.findIndex(function(a){return!!a.active}),f=a.shows[e].id,g=a.seasons[c].season;d.markSeasonNotWatched(f,g).success(function(){a.seasons.splice(c,1),a.seasons.length>0?a.getWatchedEpisodes(f,a.seasons[0].season):(a.shows.splice(e,1),a.shows.length>0&&a.getWatchedSeasons(b("orderByName")(a.shows)[0].id))})},a.markShowNotWatched=function(){var c=a.shows.findIndex(function(a){return!!a.active}),e=a.shows[c].id;d.markShowNotWatched(e).success(function(){a.shows.splice(c,1),a.shows.length>0&&a.getWatchedSeasons(b("orderByName")(a.shows)[0].id)})},e()}]);
//# sourceMappingURL=krusha.min.js.map